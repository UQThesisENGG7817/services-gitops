## name of the runner scale set to create.  Defaults to the helm release name
runnerScaleSetName: "self-hosted-medium"

## maxRunners is the max number of runners the autoscaling runner set will scale up to.
# maxRunners: 5

## minRunners is the min number of runners the autoscaling runner set will scale down to.
minRunners: 1

## template is the PodSpec for each runner Pod
template:
  spec:
    securityContext:
        fsGroup: 1001
    initContainers:
      - name: docker-setup
        image: busybox:1.35
        command: ["sh", "-c", "chmod 666 /var/run/docker.sock"]
        volumeMounts:
          - name: docker-socket
            mountPath: /var/run/docker.sock
    containers:
    - name: runner
      image: ghcr.io/uqthesisengg7817/golden-images/actions-runner:2.317.0-28b49d1
      imagePullPolicy: IfNotPresent
      env:
      #  - name: DOCKER_HOST
      #    value: unix:///var/run/docker.sock
      - name: ACTIONS_RUNNER_REQUIRE_JOB_CONTAINER
        value: "false"
      command: ["/home/runner/run.sh"]
      lifecycle:
        preStop:
          exec:
            command:
              - sh
              - -c
              - "sleep 30s"
      resources:
        limits:
          memory: 6Gi
        requests:
          cpu: 2
          memory: 4Gi
      volumeMounts:
      - name: work
        mountPath: /home/runner/_work
      - name: docker-socket
        mountPath: /var/run/docker.sock
    imagePullSecrets:
    - name: gha-image-pull-secrets 
    volumes:
    - name: work
      ephemeral:
        volumeClaimTemplate:
          spec:
            accessModes: [ "ReadWriteOnce" ]
            storageClassName: "default"
            resources:
              requests:
                storage: 50Gi
    - name: docker-socket
      hostPath:
        path: /var/run/docker.sock
    nodeSelector:
      magnum.openstack.org/role: worker